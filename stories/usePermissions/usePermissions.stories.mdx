import { Meta } from "@storybook/addon-docs/blocks";

<Meta title="hookit/usePermissions/Docs" />

# usePermissions

Layer user permissions into your application with hooks

### Usage

#### JavaScript

```tsx
const admin = {
  DoThis: true,
  DoThat: true,
  GetThis: true,
  GetThat: true,
};

const normal = {
  DoThis: true,
  DoThat: ({ firstArg, secondArg }) => firstArg === secondArg,
  GetThis: false,
  GetThat: ({ firstArg, secondArg }) => firstArg === secondArg,
};

const rules = {
  admin,
  normal,
};

// Set up PermissionsProvider to pass rules through context
export const App = () => {
  return (
    <PermissionsProvider rules={rules}>
      <Component role="admin" firstArg={1} secondArg={1} />
    </PermissionsProvider>
  );
};

// Use permissions hook to check if a user has permissions based on roles
const Component = ({ role, firstArg, secondArg }) => {
  const { canAccess } = usePermissions(role);

  const canDoThis = canAccess("DoThis", { firstArg, secondArg });

  return (
    <>
      <h3>Current User Role: {role}</h3>
      <p>canDoThis: {canDoThis ? "âœ…" : "ðŸš«"}</p>
    </>
  );
};
```

#### TypeScript

```tsx
type Permissions = "DoThis" | "DoThat" | "GetThis" | "GetThat";
type Roles = "admin" | "normal" | "free";

const admin: TPermissions<Permissions> = {
  DoThis: true,
  DoThat: true,
  GetThis: true,
  GetThat: true,
};

type ARGS = { firstArg: number; secondArg: number };

const normal: TPermissions<Permissions> = {
  DoThis: true,
  DoThat: ({ firstArg, secondArg }: ARGS) => firstArg === secondArg,
  GetThis: false,
  GetThat: ({ firstArg, secondArg }: ARGS) => firstArg === secondArg,
};

const rules: TRules<Permissions, Roles> = {
  admin,
  normal,
};

export const App: React.FC = () => {
  return (
    <PermissionsProvider rules={rules}>
      <Component role="admin" />
    </PermissionsProvider>
  );
};

const Component: React.FC<{
  role: Roles;
  firstArg: number;
  secondArg: number;
}> = ({ role, firstArg, secondArg }) => {
  const { canAccess } = usePermissions<Permissions, Roles>(role);

  const canDoThis = canAccess<ARGS>("DoThis", { firstArg, secondArg });
  const canDoThat = canAccess<ARGS>("DoThat", { firstArg, secondArg });
  const canGetThis = canAccess<ARGS>("GetThis", { firstArg, secondArg });
  const canGetThat = canAccess<ARGS>("GetThat", { firstArg, secondArg });

  return (
    <>
      <h3>Current User Role: {role}</h3>
      <p>canDoThis: {canDoThis ? "âœ…" : "ðŸš«"}</p>
      <p>canDoThat: {canDoThat ? "âœ…" : "ðŸš«"}</p>
      <p>canGetThis: {canGetThis ? "âœ…" : "ðŸš«"}</p>
      <p>canGetThat: {canGetThat ? "âœ…" : "ðŸš«"}</p>

      <p>
        Rules:
        <pre>
          <code>
            {JSON.stringify(
              rules,
              function (_, value) {
                return typeof value === "function" ? "Function" : value;
              },
              2
            )}
          </code>
        </pre>
      </p>
    </>
  );
};
```
